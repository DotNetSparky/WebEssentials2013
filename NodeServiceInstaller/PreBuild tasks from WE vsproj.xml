  <UsingTask TaskName="MadsKristensen.EditorExtensions.PreBuildTask" TaskFactory="CodeTaskFactory" AssemblyFile="$(MSBuildToolsPath)\Microsoft.Build.Tasks.v12.0.dll">
    <ParameterGroup>
      <BuildNodeFiles ParameterType="System.Boolean" Required="false" />
      <CleanResources ParameterType="System.Boolean" Required="false" />
    </ParameterGroup>
    <Task>
      <Reference Include="Microsoft.CSharp" />
      <Reference Include="System.IO.Compression" />
      <Reference Include="System.IO.Compression.FileSystem" />
      <Reference Include="System.Web.Helpers" />
      <Code Language="cs" Source="PreBuildTask.cs" />
    </Task>
  </UsingTask>
  <Target Name="BeforeBuild" Condition="'$(BuildNode)' = 'true'">
    <MadsKristensen.EditorExtensions.PreBuildTask BuildNodeFiles="$(BuildNode)" CleanResources="$(CleanResources)" />
     <!-- Copy node.js server and services to tools -->
    <ItemGroup>
      <NodeServerSource Include="$(MSBuildProjectDirectory)\Resources\server\**\*.*" Exclude="$(MSBuildProjectDirectory)\Resources\server\.jshintrc" />
    </ItemGroup>
    <Copy SourceFiles="@(NodeServerSource)" DestinationFolder="$(MSBuildProjectDirectory)\Resources\nodejs\tools\server\%(RecursiveDir)" SkipUnchangedFiles="true" />
    <!-- Include newly downloaded files now.. -->
    <ItemGroup>
      <Content Include="Resources\nodejs\tools\**">
        <IncludeInVSIX>true</IncludeInVSIX>
      </Content>
      <!-- Exclude LESS & SASS because they have too many extra files; use a whitelist instead -->
      <!-- Mocha comes from some package that forgot about "devDependencies"; Jade comes from Mocha -->
      <!--
  <Content Include="Resources\nodejs\tools\**" Exclude="&#xD;&#xA; **\node-sass\**; **\less\**; &#xD;&#xA;               **\mocha\**; **\jade\**; &#xD;&#xA;               **\*.md; **\*.markdown; **\*.html; **\*.txt; **\LICENSE; **\README; **\CHANGELOG; **\CNAME; **\*.old; **\*.patch; **\*.ico; &#xD;&#xA;               **\*.json; **\.*; **\Makefile.*; **\Rakefile; **\*.yml; &#xD;&#xA;               **\test.*; **\generate-*; &#xD;&#xA;               **\*.min.js; **\*-min.js; &#xD;&#xA;               **\media\**; **\images\**; **\man\**; &#xD;&#xA;               **\.bin\**; **\benchmark\**; **\build\**; **\scripts\**; &#xD;&#xA;               **\vendor\**; &#xD;&#xA;               **\test\**; **\tst\**; **\tests\**; **\testing\**; &#xD;&#xA;               **\examples\**; **\example\**; **\tools\**\tools\**">
        <IncludeInVSIX>true</IncludeInVSIX>
      </Content>
      <Content Include="Resources\nodejs\tools\node_modules\node-sass\index.js; Resources\nodejs\tools\node_modules\node-sass\bin\node-sass; Resources\nodejs\tools\node_modules\node-sass\lib\**; Resources\nodejs\tools\node_modules\node-sass\vendor\win32-ia32\**; Resources\nodejs\tools\node_modules\tslint\**; Resources\nodejs\tools\node_modules\jscs\**; Resources\nodejs\tools\node_modules\coffeelint\**;    Resources\nodejs\tools\node_modules\rtlcss\lib\**;    Resources\nodejs\tools\node_modules\rtlcss\bin\rtlcss.js;">
        <IncludeInVSIX>true</IncludeInVSIX>
      </Content>
      <Content Include="Resources\nodejs\tools\node_modules\less\index.js; Resources\nodejs\tools\node_modules\less\lib\**; Resources\nodejs\tools\node_modules\less\bin\**">
        <IncludeInVSIX>true</IncludeInVSIX>
      </Content>
      -->
      <!-- Explicit inclusions for CSON -->
      <!--
      <Content Include="Resources\nodejs\tools\node_modules\cson\package.json; Resources\nodejs\tools\node_modules\cson\out\**; Resources\nodejs\tools\node_modules\js2coffee\package.json;">
        <IncludeInVSIX>true</IncludeInVSIX>
      </Content>
      -->
      <!-- Explicitly include JSON files that are actually needed at runtime -->
      <!--
      <Content Include="Resources\nodejs\tools\node_modules\htmlparser2\lib\entities\**; Resources\nodejs\tools\node_modules\jshint\package.json; Resources\nodejs\tools\node_modules\node-sass\package.json; Resources\nodejs\tools\node_modules\less\package.json; Resources\nodejs\tools\node_modules\resolve\lib\core.json; Resources\nodejs\tools\node_modules\escodegen\package.json;  Resources\nodejs\tools\node_modules\caniuse-db\**\*.json;">
        <IncludeInVSIX>true</IncludeInVSIX>
      </Content>-->
      <!-- Explicitly include files that are needed for JsHint -->
      <!--
      <Content Include="Resources\nodejs\tools\node_modules\entities\maps\**; Resources\nodejs\tools\node_modules\shelljs\src\test.js;">
        <IncludeInVSIX>true</IncludeInVSIX>
      </Content>-->
    </ItemGroup>
  </Target>